from rest_framework import serializers
from pecoret.core.serializers import ValuedChoiceField, PrimaryKeyRelatedField
from backend.models.vulnerability import ProjectVulnerability, VulnerabilityTemplate, Severity
from backend.serializers.vulnerability_category import VulnerabilityCategorySerializer


class BaseVulnerabilitySerializer(serializers.ModelSerializer):
    category = PrimaryKeyRelatedField(serializer=VulnerabilityCategorySerializer)
    severity = ValuedChoiceField(choices=Severity.choices)

    class Meta:
        fields = ["severity", "category", "pk", "name", "description", "vulnerability_id", "recommendation", "cwe"]


class VulnerabilityTemplateSerializer(BaseVulnerabilitySerializer):

    class Meta:
        model = VulnerabilityTemplate
        fields = BaseVulnerabilitySerializer.Meta.fields


class ProjectVulnerabilitySerializer(BaseVulnerabilitySerializer):

    class Meta:
        model = ProjectVulnerability
        fields = BaseVulnerabilitySerializer.Meta.fields
