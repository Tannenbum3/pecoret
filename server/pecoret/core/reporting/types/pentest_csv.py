from backend.models.finding import Finding
from .base import ProjectRelatedReportType
from .mixins.plain import PlainJinjaMixin


class VulnerabilityCSVReport(PlainJinjaMixin, ProjectRelatedReportType):
    content_type = "plain/text"
    file_extension = "csv"
    default_title = "Vulnerability CSV"
    template_name = "vulnerability_overview.csv"

    def render_report(self):
        rendered_report = super().render_report()
        return rendered_report.encode()

    def get_context(self):
        context = super().get_context()
        context["findings"] = Finding.objects.for_report(self.get_project())
        return context
